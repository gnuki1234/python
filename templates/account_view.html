{% extends "base.html" %}

{% block title %}{{ account.name }}{% endblock %}

{% block content %}
<div class="page-header">
    <div>
        <h1 class="page-title">
            <i class="fas fa-building page-title-icon"></i>
            {{ account.name }}
        </h1>
        <div class="breadcrumb">
            <a href="{{ url_for('dashboard') }}">Home</a>
            <span>/</span>
            <a href="{{ url_for('accounts') }}">Accounts</a>
            <span>/</span>
            <span>{{ account.name }}</span>
        </div>
    </div>
    <div>
        <a href="{{ url_for('edit_account', id=account.id) }}" class="btn btn-primary">
            <i class="fas fa-edit"></i> Edit
        </a>
        <a href="{{ url_for('accounts') }}" class="btn btn-outline">
            <i class="fas fa-arrow-left"></i> Back
        </a>
    </div>
</div>

<div class="content-grid">
    <div>
        <!-- Account Details -->
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">
                    <i class="fas fa-info-circle icon"></i>
                    Account Details
                </h3>
            </div>
            <div class="card-body" style="padding: 0 20px;">
                <div class="field-group">
                    <div class="field-label">Account Name</div>
                    <div class="field-value">{{ account.name }}</div>
                </div>
                <div class="field-group">
                    <div class="field-label">Industry</div>
                    <div class="field-value">{{ account.industry or '-' }}</div>
                </div>
                <div class="field-group">
                    <div class="field-label">Phone</div>
                    <div class="field-value">{{ account.phone or '-' }}</div>
                </div>
                <div class="field-group">
                    <div class="field-label">Website</div>
                    <div class="field-value">{{ account.website or '-' }}</div>
                </div>
                <div class="field-group">
                    <div class="field-label">Address</div>
                    <div class="field-value">{{ account.address or '-' }}</div>
                </div>
                <div class="field-group">
                    <div class="field-label">Created</div>
                    <div class="field-value">{{ account.created_at.strftime('%Y-%m-%d %H:%M') }}</div>
                </div>
            </div>
        </div>

        <!-- Related Tickets -->
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">
                    <i class="fas fa-ticket-alt icon"></i>
                    Related Tickets ({{ account.tickets|length }})
                </h3>
                <a href="{{ url_for('new_ticket') }}" class="btn btn-sm btn-outline">New Ticket</a>
            </div>
            <div class="card-body" style="padding: 0;">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Number</th>
                            <th>Description</th>
                            <th>State</th>
                            <th>Priority</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for ticket in account.tickets[:10] %}
                        <tr>
                            <td><a href="{{ url_for('view_ticket', id=ticket.id) }}">{{ ticket.number }}</a></td>
                            <td>{{ ticket.short_description[:40] }}...</td>
                            <td><span class="badge badge-{{ ticket.state|lower|replace(' ', '-') }}">{{ ticket.state }}</span></td>
                            <td><span class="badge badge-{{ ticket.priority|lower }}">{{ ticket.priority }}</span></td>
                        </tr>
                        {% else %}
                        <tr>
                            <td colspan="4" style="text-align: center; padding: 20px; color: var(--text-muted);">
                                No tickets for this account
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div>
        <!-- Related Contacts -->
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">
                    <i class="fas fa-users icon"></i>
                    Contacts ({{ account.contacts|length }})
                </h3>
                <a href="{{ url_for('new_contact') }}" class="btn btn-sm btn-outline">New Contact</a>
            </div>
            <div class="card-body" style="padding: 0;">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Title</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for contact in account.contacts %}
                        <tr>
                            <td><a href="{{ url_for('view_contact', id=contact.id) }}">{{ contact.first_name }} {{ contact.last_name }}</a></td>
                            <td>{{ contact.job_title or '-' }}</td>
                        </tr>
                        {% else %}
                        <tr>
                            <td colspan="2" style="text-align: center; padding: 20px; color: var(--text-muted);">
                                No contacts for this account
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
{% endblock %}
